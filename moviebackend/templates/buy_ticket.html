<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Mua vé - {{ movie.title }}</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    body {font-family: Arial, sans-serif; background:#fff; color:#000;}
    a {text-decoration:none;}

    /* ===== HEADER ===== */
    header {border-bottom:3px solid #c00;}
    .topbar {display:flex; justify-content:flex-end; padding:5px 40px; font-size:14px;}
    .topbar a {color:#000; margin-left:20px;}
    .navbar {background:#fdf5dc; display:flex; align-items:center; padding:10px 40px;}
    .navbar .logo {width:80px; height:40px; background:#ccc; display:flex; align-items:center; justify-content:center; margin-right:50px;}
    .navbar nav a {margin:0 20px; font-weight:bold; color:#000;}

    /* ===== BOOKING CONTAINER ===== */
    .booking {padding:40px; display:flex; gap:40px;}
    .seat-map {flex:2; text-align:center;}
    .seat-map h2 {margin-bottom:20px; color:#c00;}
    .screen {width:100%; height:30px; background:#eee; border-radius:5px; margin:0 auto 20px;}
    .seats {display:grid; grid-template-columns: repeat(10, 1fr); gap:8px; justify-items:center;}
    .seat {
      width:25px; height:25px; background:#ddd; border-radius:4px; cursor:pointer;
    }
    .seat.selected {background:#0c0;}
    .seat.occupied {background:#c00; cursor:not-allowed;}

    .legend {margin-top:20px; display:flex; justify-content:center; gap:20px; font-size:14px;}
    .legend div {display:flex; align-items:center; gap:5px;}
    .legend .box {width:18px; height:18px; border-radius:3px;}

    /* ===== BOOKING INFO ===== */
    .booking-info {flex:1; border-left:1px solid #ddd; padding-left:30px;}
    .booking-info h3 {margin-bottom:15px; color:#c00;}
    .booking-info p {margin-bottom:10px;}
    .booking-info .summary {margin-top:20px; padding:15px; border:1px solid #eee; background:#fafafa;}
    .btn-confirm {
      display:block; width:100%; margin-top:20px; padding:12px; background:#d00; color:#fff;
      text-align:center; font-weight:bold; border-radius:4px;
    }
    .btn-confirm:hover {background:#a00;}

    /* ===== FOOTER ===== */
    footer {margin-top:60px; background:#f9f9f9; padding:30px 40px; font-size:14px; color:#333;}
    .footer-cols {display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:20px;}
    .footer-col {flex:1; min-width:180px; margin-right:20px;}
    .footer-col h4 {margin-bottom:10px; font-size:14px;}
    .footer-col a {display:block; color:#000; font-size:13px; margin:5px 0;}
    .social-icons img {width:24px; margin-right:8px;}
    .footer-bottom {text-align:center; border-top:1px solid #ddd; padding-top:15px; font-size:12px; color:#555;}
    .footer-logo {width:100px; height:40px; background:#ccc; margin:10px auto;}
  </style>
</head>
<body>

<header>
  <div class="topbar">
    <a href="#">Vé của tôi</a>
    <a href="{% url 'login' %}">Đăng nhập / Đăng ký</a>
  </div>
  <div class="navbar">
    <div class="logo">Logo</div>
    <nav>
      <a href="{% url 'index' %}">Phim</a>
      <a href="#">Rạp Phim</a>
      <a href="#">Thành viên</a>
    </nav>
  </div>
</header>

<!-- BOOKING -->
<div class="booking">
  <!-- SEAT MAP -->
  <div class="seat-map">
    <h2>Chọn ghế</h2>
    <div class="screen">Màn hình</div>
    <div class="seats">
      {% for row in seat_rows %}
        {% for seat in row %}
          <div class="seat {% if seat.is_booked %}occupied{% endif %}" 
               data-seat="{{ seat.id }}"></div>
        {% endfor %}
      {% endfor %}
    </div>
    <div class="legend">
      <div><span class="box" style="background:#ddd"></span> Trống</div>
      <div><span class="box" style="background:#0c0"></span> Đang chọn</div>
      <div><span class="box" style="background:#c00"></span> Đã đặt</div>
    </div>
  </div>

  <!-- BOOKING INFO -->
  <div class="booking-info">
    <h3>Thông tin đặt vé</h3>
    <p><strong>Phim:</strong> {{ movie.title }}</p>
    <p><strong>Rạp:</strong> {{ cinema.name }}</p>
    <p><strong>Suất chiếu:</strong> {{ showtime.start|date:"d/m/Y H:i" }}</p>

    <div class="summary">
      <p><strong>Ghế đã chọn:</strong> <span id="selected-seats">0</span></p>
      <p><strong>Tổng tiền:</strong> <span id="total-price">0</span> VND</p>
    </div>

    <a href="{% url 'payment' showtime.id %}" class="btn-confirm">XÁC NHẬN VÉ</a>
  </div>
</div>

<footer>
  <div class="footer-cols">
    <div class="footer-col">
      <h4>Rạp Việt Nam</h4>
      <a href="#">Giới Thiệu</a>
      <a href="#">Tiện ích online</a>
    </div>
    <div class="footer-col">
      <h4>Điều khoản sử dụng</h4>
      <a href="#">Điều Khoản Chung</a>
      <a href="#">Điều khoản Giao Dịch</a>
      <a href="#">Chính Sách Thanh Toán</a>
      <a href="#">Chính Sách Bảo Mật</a>
      <a href="#">Câu Hỏi Thường Gặp</a>
    </div>
    <div class="footer-col">
      <h4>Kết nối với chúng tôi</h4>
      <div class="social-icons">
        <img src="{% static 'images/facebook.png' %}" alt="fb">
        <img src="{% static 'images/youtube.png' %}" alt="yt">
        <img src="{% static 'images/zalo.png' %}" alt="zalo">
      </div>
    </div>
    <div class="footer-col">
      <h4>Chăm Sóc Khách Hàng</h4>
      <p>Hotline: 1900 6996</p>
      <p>Giờ làm việc: 8:00 - 22:00</p>
      <p>Email hỗ trợ: hoidap@ab.vn</p>
    </div>
  </div>
  <div class="footer-logo">Logo</div>
  <div class="footer-bottom">
    COPYRIGHT 2017 © CÔNG TY RẠP VIỆT NAM. ALL RIGHTS RESERVED
  </div>
</footer>

<script>
  // Chọn ghế
  const seats = document.querySelectorAll('.seat:not(.occupied)');
  const count = document.getElementById('selected-seats');
  const total = document.getElementById('total-price');
  const ticketPrice = {{ ticket_price|default:75000 }};
  let selectedSeats = 0;

  seats.forEach(seat => {
    seat.addEventListener('click', () => {
      seat.classList.toggle('selected');
      selectedSeats = document.querySelectorAll('.seat.selected').length;
      count.textContent = selectedSeats;
      total.textContent = (selectedSeats * ticketPrice).toLocaleString();
    });
  });
</script>

</body>
</html>
